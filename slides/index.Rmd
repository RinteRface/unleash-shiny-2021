---
title: "Unleash Shiny"
subtitle: "R/Pharma - Advanced Shiny Workshop"
author: "David Granjon (Novartis) & John Coene (Opifex)"
date: "10-10-2021"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["assets/css/style.css", "assets/css/xaringan-extra.css"]
    includes:
      after_body: assets/html/includes.html
    mathjax: false
    nature:
      ratio: "16:9"
      highlightStyle: docco
      highlightLines: true
      countIncrementalSlides: false
---

<style>
.title-slide {
  background-image: url(assets/img/bg/front_cover.jpg);
  background-size: cover;
}
</style>

```{r setup, include = FALSE}
if(!requireNamespace("emo", quietly = TRUE))
  remotes::install_github("hadley/emo")

if(!requireNamespace("xaringanExtra", quietly = TRUE))
  remotes::install_github("xaringanExtra")

library(emo)
library(shiny)
library(htmltools)
library(charpente)
library(XML)
xaringanExtra::use_xaringan_extra(c("tile_view", "animate_css", "tachyons"))
xaringanExtra::use_extra_styles(
  hover_code_line = TRUE,         #<<
  mute_unhighlighted_code = TRUE  #<<
)
xaringanExtra::use_panelset()

html_2_R <- charpente::html_2_R
```

```{r js4shiny, echo=FALSE}
js4shiny::html_setup(stylize = c("fonts", "variables", "code"))
```

# About us

.flex.tc[
.w-50.mr3[
<img class="br-100" src="assets/img/people/david.jpg" height=400 />
.f5[David]

.small[Data Scientist at Novartis]

.gray[&commat;divadnojnarg]
]

.w-50.mr3[
<img class="br-100" src="assets/img/people/john.jpg"  height=400/>
.f5[John]

.small[Software Engineer at Opifex]

.gray[&commat;jdatap]
]

]

---

# Program

We're in for 2 hours of **fun**!

- Grab a `r ji("coffee")`
- Make yourself comfortable `r ji("couch")` or ðŸ§˜
- Ask questions `r ji("question")`  

1. Introduction 				5  min
2. Bundling with packer 10 min
3. R model 							5  min
4. Project Setup 				30 min
5. _Break_ 							5  min
6. Framework 7 					30 min
7. Echarts.js 					15 min
8. Questions

---

# Workshop Material

- Slides: [rinterface.com/shiny/talks/RPharma2021](https://rinterface.com/shiny/talks/RPharma2021)
- For a plug and play experience, we created a [Rstudio Cloud](https://rstudio.cloud/spaces/92568/join?access_code=kqUUGAOZMMHSZoAQBrQ1GHSOBxSE4u1q8JvrJoRs) project with everything installed for you

.center[
https://rstudio.cloud/spaces/92568/join?access_code=kqUUGAOZMMHSZoAQBrQ1GHSOBxSE4u1q8JvrJoRs
]
  
- To avoid **connection issues**, disconnect from your **VPN**!
- Somes slides contain code that you may run (a **sandbox** space is available in RStudio Cloud)

```{r rstudio-cloud-init, echo=FALSE, out.width='100%'}
knitr::include_graphics("assets/img/rstudio_cloud_project.jpg")
```

---
class: break center middle
background-image: url('assets/img/bg/intro.png')
background-size: cover

<h3 class="primary absolute bottom center">
Introduction
</h3>

---
class: header_background

# Intro

---
class: break center middle
background-image: url('assets/img/bg/packer.png')
background-size: cover

<h3 class="primary" style="position:absolute;top:1rem;">
Managing JavaScript
</h3>

---
class: header_background

## Pre-processing JavaScript

### Why?
### What?

---

# Code Management

Large projects are complex, the developer needs help

Use something that enforces good practice and project
structure.

.pull-left[
__In R__

- Build a package
- Use [drake](https://github.com/ropensci/drake)
- Use [targets](https://github.com/wlandau/targets)

]

.pull-right[
__In JavaScript__

There is nothing such---built-in---we work with loose collections
of files.
]

---
class: center

# Browser Support

`r ji("check")` R code written in `4.0.0` will (likely) run on `3.0.0`+

`r ji("death")` JavaScript not so much.

![[caniuse.com](https://caniuse.com/?search=ES6)](assets/img/es6.png)

ES6 [released June 2016](https://en.wikipedia.org/wiki/ECMAScript)

---
# Code Size

Code size matters in JavaScript: the smaller the file the faster it loads.

.pull-left[

### Input

Can be written and read by a human.

```js
function addOne(xyz){
  return xyz + 1;
}

addOne(2);
```
]

.pull-right[

###  Minified

Loads faster but can't be written or read by a human.

```js
function addOne(n){return n+1}addOne(2);
```
]

---

## Conclusion

We need to pre-process the code to:

- Minify it for performances
- Transpile to ensure it runs an (nearly) all browsers
- Be able to setup code management

It does not end here.

_Pre-processing enables even more._

---

# Dependency Management

No packages system with JavaScript but there is one
for node.js---Node's Package Manager (NPM)---that 
can be used when __preprocessing__ the code.

.pull-left[
__MANUAL__
```html
<script src="file1.js"></script>
<script src="file2.js"></script>
<script src="file3.js"></script>
```

`r ji("-1")` Difficult to manage.
]

.pull-right[
__NPM__

```bash
npm install dplyr
```

then


```js
import { mutate } from 'dplyr';
```

`r ji("+1")` Easy to manage.
]

---
class: center

## Tree-shaking

Checking for dead variables.

## Code checks

Discover errors when you write the code, not when you run it.

__And so much more...__

---
class: header_background

## Downside

1. There are a variety of tools to do the job (webpack, Grunt, Parcel, etc.)
2. They are generally difficult to set up.
3. They're not designed to work with R in mind.

---
class: center
# Meet packer!

<img src="https://packer.john-coene.com/_media/packer.png" height="200px" />

[packer.john-coene.com](https://packer.john-coene.com/)

---
class: center, centerize
# Principles

Anything packer-related takes places in a `r ji("package")`

__Does not__ become a dependency to what you're building 

It aspires to be a specialised {[usethis](https://usethis.r-lib.org/)}:

automate tasks when building packages __with JavaScript.__
---
class: header_background

# Using packer

Set it up first.

1. Create a package (or {[golem](https://golemverse.org/)} app)
2. Scaffold 

Then write some code and bundle with `packer::bundle()`,
which produces the JavaScript code.

---
# Scaffolds?

Scaffolds are central to packer. They create the necessary structure to use webpack and npm __with R.__

- Golem - use packer with {golem}
- Htmlwidgets - use packer to create {htmlwidgets}
- Extensions - create shiny extensions (handlers)
- Inputs - create custom inputs
- Outputs - create custom outputs
- And a few more.

e.g.: 

```r
packer::scaffold_golem()
```

_The term "scaffold" was blatantly stolen from `htmlwidgets::scaffoldWidget`._

---
class: center, centerize

# Bundle?

Source code is written in `/srcjs` and is bundled to `/inst`

```r
packer::bundle()
```

---
class: break center middle
background-image: url('assets/img/bg/model.png')
background-size: cover

<h3 class="primary absolute bottom center">
R Model
</h3>

---
class: header_background

# Intro

---
class: break center middle
background-image: url('assets/img/bg/break.png')
background-size: cover

<h3 class="primary absolute bottom center">
Break!
</h3>

<p class='primary absolute white' style='bottom:2rem;'>
See you in 5 minutes.
</p>

---
class: break center middle
background-image: url('assets/img/bg/setup.png')
background-size: cover

<h3 class="primary absolute bottom center">
Project Setup
</h3>

---
class: header_background

# Intro

---
class: break center middle
background-image: url('assets/img/bg/f7.png')
background-size: cover

<h3 class="primary absolute bottom center">
Framework 7
</h3>

---
class: header_background

# Intro

---
class: break center middle
background-image: url('assets/img/bg/break.png')
background-size: cover

<h3 class="primary absolute bottom center">
Break!
</h3>

<p class='primary absolute white' style='bottom:2rem;'>
See you in 5 minutes.
</p>

---
class: break center middle
background-image: url('assets/img/bg/echarts.png')
background-size: cover

<h3 class="primary absolute bottom center">
Echarts.js
</h3>

---
class: header_background

# Intro

---
class: break center middle
background-image: url('assets/img/bg/question.png')
background-size: cover

<h3 class="primary absolute bottom center">
Questions?
</h3>